{% extends 'admin/admin_base.html' %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
    <div class="admin-container">
        <div class="card">
            <h2>Users Online</h2>
            <ul>
                {% for user in users %}
                {% if user.is_online %}<li>{{ user.username }}</li>{% endif %}
                {% endfor %}
            </ul>
        </div>

        <div class="card">
            <h2>Conversation Management</h2>
            <form action="{{ url_for('admin_bp.toggle_ai') }}" method="post">
                <button type="submit">{{ 'Disable' if config.ai_teacher_enabled else 'Enable' }} AI Teacher</button>
            </form>
            <form id="start-conversation-form">
                <button type="submit">Start New Conversation</button>
            </form>
            <script>
                document.getElementById('start-conversation-form').addEventListener('submit', function(event) {
                    event.preventDefault();
                    fetch('{{ url_for("message_bp.start_conversation") }}', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                        body: new URLSearchParams()
                    })
                    .then(response => response.json())
                    .then(data => { alert(`Conversation started: ${data.title}`); })
                    .catch(error => { console.error('Error:', error); });
                });
            </script>
            <form action="{{ url_for('admin_bp.toggle_message_sending') }}" method="post">
                <button type="submit">{{ 'Disable' if config.message_sending_enabled else 'Enable' }} Message Sending</button>
            </form>
        </div>

        <div class="card">
            <h2>Ban A Word</h2>
            <form action="{{ url_for('admin_bp.add_banned_word') }}" method="post">
                <input type="text" name="word" placeholder="Enter new banned word" required>
                <textarea name="reason" placeholder="Enter reason (optional)"></textarea>
                <button type="submit">Add Word</button>
            </form>
        </div>

        <div class="card">
            <h2>Adjust Ducks</h2>
            <form action="{{ url_for('admin_bp.adjust_ducks') }}" method="post">
                <label for="username">User:</label>
                <select name="username" required>
                    {% for user in users|sort(attribute='username') %}
                    <option value="{{ user.username }}">{{ user.username }}</option>
                    {% endfor %}
                </select>
                <label for="amount">Amount:</label>
                <input type="number" name="amount" required placeholder="Enter amount (+/-)">
                <button type="submit">Update Ducks</button>
            </form>
        </div>

        <div class="card">
            <h2>Trades</h2>
            <a href="/admin/pending_trades">
                <button>Pending Trades</button>
            </a>
        </div>
    </div>
{% endblock %}