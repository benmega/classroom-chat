{% extends 'base.html' %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/edit_profile.css') }}">

<div class="edit-profile-container">
    <h1>Edit Profile</h1>
    <form method="POST" action="{{ url_for('user_bp.edit_profile') }}">
        <!-- Username Field  REMOVED FOR SECURITY-->
<!--        <div class="form-group">-->
<!--            <label for="username">Username:</label>-->
<!--            <input type="text" id="username" name="username" value="{{ user.username }}" required>-->
<!--        </div>-->

        <!-- Password Field -->
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" placeholder="Leave blank to keep current password">
        </div>

        <!-- IP Address Field -->
        <div class="form-group">
            <label for="ip_address">IP Address:</label>
            <input type="text" id="ip_address" name="ip_address" value="{{ user.ip_address }}">
        </div>

        <!-- Online Status Field -->
        <div class="form-group">
            <label for="is_online">Online Status:</label>
            <select id="is_online" name="is_online">
                <option value="true" {% if user.is_online %}selected{% endif %}>Online</option>
                <option value="false" {% if not user.is_online %}selected{% endif %}>Offline</option>
            </select>
        </div>

        <!-- Skills Section -->
        <div class="form-group">
            <label for="skills">Skills:</label>
            <div id="skills-container">
                {% for skill in user.skills %}
                <div class="skill-entry">
                    <input type="text" name="skills[]" value="{{ skill.name }}">
                    <button type="button" class="remove-skill">Remove</button>
                </div>
                {% endfor %}
            </div>
            <button type="button" id="add-skill">Add Skill</button>
        </div>

        <!-- Projects Section -->
        <div class="form-group">
            <label for="projects">Projects:</label>
            <div id="projects-container">
                {% for project in user.projects %}
                <div class="project-entry">
                    <input type="text" name="project_names[]" value="{{ project.name }}" placeholder="Project Name">
                    <input type="text" name="project_descriptions[]" value="{{ project.description }}" placeholder="Project Description">
                    <input type="text" name="project_links[]" value="{{ project.link }}" placeholder="Project Link">
                    <button type="button" class="remove-project">Remove</button>
                </div>
                {% endfor %}
            </div>
            <button type="button" id="add-project">Add Project</button>
        </div>

        <!-- Submit and Cancel Buttons -->
        <div class="form-group">
            <button type="submit" class="btn-save">Save Changes</button>
            <a href="{{ url_for('user_bp.profile') }}" class="btn-cancel">Cancel</a>
        </div>
    </form>
</div>

<script>
    // JavaScript for adding/removing dynamic fields
    document.getElementById('add-skill').addEventListener('click', function() {
        const container = document.getElementById('skills-container');
        const newField = document.createElement('div');
        newField.classList.add('skill-entry');
        newField.innerHTML = `<input type="text" name="skills[]" placeholder="New Skill"><button type="button" class="remove-skill">Remove</button>`;
        container.appendChild(newField);
    });

    document.getElementById('add-project').addEventListener('click', function() {
        const container = document.getElementById('projects-container');
        const newField = document.createElement('div');
        newField.classList.add('project-entry');
        newField.innerHTML = `
            <input type="text" name="project_names[]" placeholder="Project Name">
            <input type="text" name="project_descriptions[]" placeholder="Project Description">
            <input type="text" name="project_links[]" placeholder="Project Link">
            <button type="button" class="remove-project">Remove</button>`;
        container.appendChild(newField);
    });

    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-skill')) {
            e.target.parentElement.remove();
        }
        if (e.target.classList.contains('remove-project')) {
            e.target.parentElement.remove();
        }
    });
</script>
{% endblock %}
