<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom Chat is Sleeping</title>

    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet"/>

    <style>
        :root {
            --primary-color: #0EB2BB;
            --secondary-color: #007BFF;
            --text-color: #2e2e2e;
            --highlight: #FFF455;
            --font: 'Nunito', sans-serif;
        }

        body {
            margin: 0;
            font-family: var(--font);
            background: linear-gradient(135deg, #f6f8fc, #e0f7fa);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }

        .main-container {
            max-width: 580px;
            width: 100%;
        }

        img.duck {
            width: 200px;
            height: auto;
            margin-bottom: 20px;
            filter: drop-shadow(0 4px 12px rgba(0,0,0,0.1));
        }

        h1 {
            font-size: 2.8rem;
            color: var(--primary-color);
            font-weight: 800;
            margin: 0 0 16px 0;
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.3rem;
            color: var(--text-color);
            margin: 0 0 32px 0;
            opacity: 0.85;
            font-weight: 400;
        }

        button {
            padding: 18px 48px;
            margin: 0;
            border: none;
            font-size: 1.4rem;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            background: linear-gradient(135deg, var(--secondary-color), #0056b3);
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 123, 255, 0.3);
            width: 100%;
            max-width: 400px;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 28px rgba(0, 123, 255, 0.4);
        }

        button:active:not(:disabled) {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }

        #message {
            margin-top: 20px;
            min-height: 28px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        #progress-container {
            margin-top: 40px;
            width: 100%;
            display: none;
        }

        #progress-container.active {
            display: block;
        }

        #server-icon {
            font-size: 5rem;
            margin-bottom: 24px;
            display: none;
        }

        #server-icon.active {
            display: block;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% {transform: translateY(0);}
            50% {transform: translateY(-20px);}
        }

        #progress-bar-bg {
            background: rgba(0, 0, 0, 0.08);
            border-radius: 24px;
            height: 40px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        #progress-bar {
            height: 100%;
            width: 0%;
            border-radius: 24px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--primary-color));
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
            transition: width 0.3s ease;
        }

        @keyframes shimmer {
            0% {background-position: 200% 0;}
            100% {background-position: -200% 0;}
        }

        #time-remaining {
            margin-top: 16px;
            font-size: 2rem;
            font-weight: 800;
            color: var(--secondary-color);
        }

        #progress-text {
            margin-top: 12px;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-color);
            opacity: 0.8;
        }

        #fun-status {
            margin-top: 20px;
            font-size: 1.35rem;
            font-style: italic;
            min-height: 32px;
            color: var(--primary-color);
            animation: fadeIn 0.5s ease;
            font-weight: 600;
        }

        @keyframes fadeIn {
            from {opacity: 0; transform: translateY(-5px);}
            to {opacity: 1; transform: translateY(0);}
        }

        .status-success {color: #28a745;}
        .status-error {color: #dc3545;}
        .status-loading {color: var(--secondary-color);}

        @media (max-width: 600px) {
            img.duck {
                width: 160px;
            }

            h1 {
                font-size: 2.2rem;
            }

            .subtitle {
                font-size: 1.1rem;
            }

            button {
                font-size: 1.2rem;
                padding: 16px 40px;
            }

            #time-remaining {
                font-size: 1.6rem;
            }
        }
    </style>
</head>

<body>
    <div class="main-container">
        <img class="duck" src="sleeping_duck.gif" alt="Sleeping Duck">

        <h1>Classroom Chat is Sleeping</h1>

        <p class="subtitle">Wake it up so students can chat and earn ducks!</p>

        <button id="startServerButton">Wake Up the Classroom Chat</button>

        <div id="message"></div>

        <div id="progress-container">
            <div id="server-icon">ðŸš€</div>
            <div id="progress-bar-bg">
                <div id="progress-bar"></div>
            </div>
            <div id="time-remaining"></div>
            <div id="progress-text">Starting up...</div>
            <div id="fun-status"></div>
        </div>
    </div>

    <script>
        const API_URL = 'https://e5fsaweh7l.execute-api.ap-southeast-1.amazonaws.com/server-start';
        const button = document.getElementById('startServerButton');
        const message = document.getElementById('message');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const timeRemaining = document.getElementById('time-remaining');
        const funStatus = document.getElementById('fun-status');
        const serverIcon = document.getElementById('server-icon');

        const TOTAL_TIME = 300;

        const funMessages = [
            "ðŸ”Œ Plugging in the cables...",
            "ðŸ§¹ Dusting off the servers...",
            "â˜• Making coffee for the CPU...",
            "ðŸ”¥ Warming up the processors...",
            "ðŸ“š Loading the database dictionaries...",
            "ðŸŽ¨ Painting the bits and bytes...",
            "ðŸŽµ Teaching the server to sing...",
            "ðŸ§  Giving the AI a pep talk...",
            "ðŸš‚ All aboard the data train!",
            "ðŸŽ¯ Calibrating the laser precision...",
            "ðŸŒŸ Sprinkling magic server dust...",
            "ðŸ” Unlocking the digital vaults...",
            "ðŸŽª Setting up the circus... I mean servers...",
            "ðŸ§² Magnetizing the hard drives...",
            "ðŸŽ­ Rehearsing the startup routine...",
            "ðŸ• Feeding the hungry servers...",
            "ðŸŽ¸ Tuning the network strings...",
            "ðŸ—ï¸ Building virtual scaffolding...",
            "ðŸŽ¨ Coloring inside the lines of code...",
            "ðŸš€ Initiating countdown sequence...",
            "ðŸŒˆ Adding rainbow optimizations...",
            "ðŸŽ¯ Taking aim at perfection...",
            "ðŸ”® Consulting the tech oracle...",
            "ðŸŽª Juggling packets and bits...",
            "ðŸŽ¬ Lights, camera, server action!",
            "ðŸ§ª Mixing the perfect server potion...",
            "ðŸ“¡ Beaming up the resources...",
            "ðŸŽ¼ Composing the startup symphony...",
            "ðŸƒ Warming up for the race...",
            "âœ¨ Almost there! Final touches..."
        ];

        let currentMessageIndex = 0;
        let progressInterval;
        let messageInterval;
        let startTime;

        function updateFunMessage() {
            funStatus.style.animation = 'none';
            setTimeout(() => {
                funStatus.textContent = funMessages[currentMessageIndex];
                funStatus.style.animation = 'fadeIn 0.5s ease';
                currentMessageIndex = (currentMessageIndex + 1) % funMessages.length;
            }, 50);
        }

        function formatTime(sec) {
            const m = Math.floor(sec / 60);
            const s = sec % 60;
            return `${m}:${s.toString().padStart(2,'0')}`;
        }

        function startProgress() {
            startTime = Date.now();
            progressContainer.classList.add('active');
            serverIcon.classList.add('active');
            updateFunMessage();

            messageInterval = setInterval(updateFunMessage, 6000);

            progressInterval = setInterval(() => {
                const elapsed = (Date.now() - startTime) / 1000;
                const remaining = Math.max(0, TOTAL_TIME - Math.floor(elapsed));
                const pct = Math.min(100, (elapsed / TOTAL_TIME) * 100);

                progressBar.style.width = pct + '%';
                timeRemaining.textContent = formatTime(remaining);

                if (pct < 33) progressText.textContent = 'Warming up...';
                else if (pct < 66) progressText.textContent = 'Loading resources...';
                else if (pct < 100) progressText.textContent = 'Almost ready...';
                else {
                    progressText.textContent = 'Ready. Refreshing...';
                    clearInterval(progressInterval);
                    clearInterval(messageInterval);

                    setTimeout(() => {
                        const base = window.location.href.split('?')[0];
                        window.location.replace(base + '?nocache=' + Date.now());
                    }, 1000);
                }
            }, 100);
        }

        button.addEventListener('click', async () => {
            button.disabled = true;
            message.className = 'status-loading';
            message.textContent = 'Sending wake up signal...';

            try {
                const resp = await fetch(API_URL, {method: 'POST', mode: 'cors'});
                if (resp.ok) {
                    message.className = 'status-success';
                    message.textContent = 'Wake up signal sent. Classroom Chat is starting...';
                    startProgress();
                } else {
                    message.className = 'status-error';
                    message.textContent = 'Unable to wake the server. Try again soon.';
                    button.disabled = false;
                }
            } catch {
                message.className = 'status-error';
                message.textContent = 'Network error while sending the wake up signal.';
                button.disabled = false;
            }
        });
    </script>
</body>
</html>